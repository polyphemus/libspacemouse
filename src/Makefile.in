header = spacemouse.h spacemouse_udev.h spacemouse_evdev.h
obj = spacemouse_udev.o spacemouse_evdev.o
lib_a = libspacemouse.a
soname = libspacemouse.so.0
lib_so = $(soname).1

CC = gcc
AR = ar
CFLAGS = $(opt) $(debug) -std=c89 -fPIC -pedantic -Wall -fno-strict-aliasing $(user_cflags)
LDFLAGS = $(user_ldflags)

.PHONY: all
all: $(header) $(lib_a) $(lib_so)

$(lib_a): $(obj)
	$(AR) rcs $@ $(obj)

$(lib_so): $(obj)
	$(CC) -shared -Wl,-soname,$(soname),-rpath,. -o $@ $(obj) $(LDFLAGS) -L. -ludev

%.o: %.c
	$(CC) $(CFLAGS) -D MAP_AXIS_SPACENAVD -c $< -o $@

.PHONY: clean
clean:
	rm -f $(obj) $(lib_a) $(lib_so)