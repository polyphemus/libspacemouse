lib_header = libspacemouse.h
lib_a = libspacemouse.a
lib_so_link_link = libspacemouse.so
lib_so_link = $(lib_so_link_link).0
lib_so = $(lib_so_link).1

all: $(lib_header) src $(lib_a) $(lib_so)

.PHONY: src
src:
	@$(MAKE) -C src

$(lib_a):
	cp src/$(lib_a) .

$(lib_so):
	cp src/$(lib_so) .

.PHONY: install
install: $(lib_header) src $(lib_a) $(lib_so)
	install -D -m 644 $(lib_header) $(DESTDIR)$(PREFIX)/include/$(lib_header)
	install -D -m 644 $(lib_a) $(DESTDIR)$(PREFIX)/lib/$(lib_a)
	install -D -m 755 $(lib_so) $(DESTDIR)$(PREFIX)/lib/$(lib_so)
	ln -f -s $(lib_so) $(DESTDIR)$(PREFIX)/$(libdir)/$(lib_so_link)
	ln -f -s $(lib_so_link) $(DESTDIR)$(PREFIX)/$(libdir)/$(lib_so_link_link)

.PHONY: uninstall
uninstall:
	rm -f $(DESTDIR)$(PREFIX)/include/$(lib_header) \
	$(DESTDIR)$(PREFIX)/$(libdir)/$(lib_a) \
	$(DESTDIR)$(PREFIX)/$(libdir)/$(lib_so) \
	$(DESTDIR)$(PREFIX)/$(libdir)/$(lib_so_link) \
	$(DESTDIR)$(PREFIX)/$(libdir)/$(lib_so_link_link)

.PHONY: clean
clean:
	@$(MAKE) -C src clean
	rm -f $(lib_a) $(lib_so)

.PHONY: distclean
distclean: clean
	@$(MAKE) -C examples clean
	rm -f ./src/Makefile Makefile

.PHONY: examples
examples: $(lib_header) src $(lib_a) $(lib_so)
	@$(MAKE) -C examples
